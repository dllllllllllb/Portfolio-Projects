//Author: Maciej Dowbor
//Module: MED5149
//Date last accessed: 20/01/2021

#ifndef PLAYER_H
#define PLAYER_H

#include <SFML/Window/Keyboard.hpp>
#include <SFML/Window.hpp>

#include "BulletPool.h"
#include "EnemyDropHandler.h"
#include "Object.h"
#include "PlayerValuesEnum.h"
#include "PlayerWeaponsEnum.h"
#include "UserInterface.h"

//=====================================================================================================	
//Class		: Player
//-----------------------------------------------------------------------------------------------------
//Purpose	: Player controlled object
//=====================================================================================================
class Player : public Object
{
private:

	BulletPool			m_bulletPool;
	float				m_fireTimer;
	float				m_rateOfFire;
	float				m_speed;
	bool				m_reloaded;
	bool				m_isKeyPressed;
	float				m_rotation;
	sf::RenderWindow	&m_window;
	UserInterface		*m_pUserInterface;
	EnemyDropHandler	*m_pEnemyDropHandler;
	PlayerWeapons		m_weaponType;

	int					m_health;
	int					m_shield;
	int					m_score;
	int					m_credits;

	float				m_bulletWidth;
	bool				m_areControlsActive;

	bool				m_tookDamage;
	float				m_invulnerabilityTimer;

	sf::SoundBuffer		m_bufferDeath;
	sf::SoundBuffer		m_bufferPickup;
	sf::SoundBuffer		m_bufferCoinPickup;
	sf::SoundBuffer		m_bufferTakingDamage;

	sf::Sound			m_soundDeath;
	sf::Sound			m_soundPickup;
	sf::Sound			m_soundCoinPickup;
	sf::Sound			m_soundTakingDamage;

	//Functions
	void checkInput( const float &deltaTime );
	//=================================================================================================						
	//Purpose	: Checks for player input
	//-------------------------------------------------------------------------------------------------
	//Parameters: Time passed since last frame
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void smoothRotation( const float &deltaTime, const bool direction );
	//=================================================================================================						
	//Purpose	: Rotates player when moving
	//-------------------------------------------------------------------------------------------------
	//Parameters: Time passed since last frame and movement direction
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void resetRotation( const float &deltaTime );
	//=================================================================================================						
	//Purpose	: Resets player rotation
	//-------------------------------------------------------------------------------------------------
	//Parameters: Time passed since last frame
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void shoot( );
	//=================================================================================================						
	//Purpose	: Shoot bullet based on weapon type
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void singleShot( );
	//=================================================================================================						
	//Purpose	: Shoots one bullet
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void doubleShot( );
	//=================================================================================================						
	//Purpose	: Shoots two bullets
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void tripleShot( );
	//=================================================================================================						
	//Purpose	: Shoots three bullets
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void quadraShot( );
	//=================================================================================================						
	//Purpose	: Shoots four bullets
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void updateBullets( const float &deltaTime );
	//=================================================================================================						
	//Purpose	: Updates active bullets
	//-------------------------------------------------------------------------------------------------
	//Parameters: Time passed since last frame
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void reload( const float &deltaTime );
	//=================================================================================================						
	//Purpose	: Reloads weapon
	//-------------------------------------------------------------------------------------------------
	//Parameters: Time passed since last frame
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void checkDropsCollision( );
	//=================================================================================================						
	//Purpose	: 
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void takeDamage( const int &damage );
	//=================================================================================================						
	//Purpose	: Inflicts damage to player
	//-------------------------------------------------------------------------------------------------
	//Parameters: Damage value
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void checkHealth( );
	//=================================================================================================						
	//Purpose	: Checks players health to determine if player lost
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void invulnerability( const float &deltaTime );
	//=================================================================================================						
	//Purpose	: Temporary invulnerability for the player after taking damage
	//-------------------------------------------------------------------------------------------------
	//Parameters: Time passed since last frame
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void setUpAudio( );
	//=================================================================================================						
	//Purpose	: Load and set up player audio
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================


public:

	Player( sf::RenderWindow &window, const sf::Texture &playerTexture, const sf::Texture &bulletTexture, UserInterface *UI, EnemyDropHandler *enemyDropHandler );
	//=================================================================================================						
	//Purpose	: Constructor
	//-------------------------------------------------------------------------------------------------
	//Parameters: Render window, player texture, bullet texture, user interface pointer and enemy drop
	//			  handler pointer
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	~Player( );
	//=================================================================================================						
	//Purpose	: Destructor
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void update( const float &deltaTime );
	//=================================================================================================						
	//Purpose	: Updates contents of this class
	//-------------------------------------------------------------------------------------------------
	//Parameters: Time passed since last frame
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void drawBullets( );
	//=================================================================================================						
	//Purpose	: Draws bullets
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	BulletPool *getBulletPool( );
	//=================================================================================================						
	//Purpose	: Return pointer to a bullet pool
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: Bullet pool pointer
	//=================================================================================================

	void setWeaponType( const PlayerWeapons &weaponType );
	//=================================================================================================						
	//Purpose	: Set player weapon
	//-------------------------------------------------------------------------------------------------
	//Parameters: Player weapon as enum
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	const PlayerWeapons getWeaponType( ) const;
	//=================================================================================================						
	//Purpose	: Return players weapon type as enum
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: Player weapon type as enum
	//=================================================================================================


	void changeValueInt( const PlayerValues &variable, const int &value );
	//=================================================================================================						
	//Purpose	: Change int variable value
	//-------------------------------------------------------------------------------------------------
	//Parameters: Variable as enum and value
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void changeValueFloat( const PlayerValues &variable, const float &value );
	//=================================================================================================						
	//Purpose	: Change float variable value
	//-------------------------------------------------------------------------------------------------
	//Parameters: Variable as enum and value
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	const int &getValue( const PlayerValues &variable ) const;
	//=================================================================================================						
	//Purpose	: Return int variable
	//-------------------------------------------------------------------------------------------------
	//Parameters: Variable as enum
	//-------------------------------------------------------------------------------------------------
	//Returns	: Value of a variable
	//=================================================================================================

	void toggleControls( );
	//=================================================================================================						
	//Purpose	: Disables/ enables player controls
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================

	void reset( );
	//=================================================================================================						
	//Purpose	: Resets player values to default
	//-------------------------------------------------------------------------------------------------
	//Parameters: -
	//-------------------------------------------------------------------------------------------------
	//Returns	: -
	//=================================================================================================
};

#endif // !PLAYER_H
